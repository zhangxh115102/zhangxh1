package com.shsunedu.api;

import javax.annotation.Resource;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.shsunedu.base.api.model.Course;
import com.shsunedu.base.api.service.ICourseLessonLearnService;
import com.shsunedu.base.api.service.ICourseLessonService;
import com.shsunedu.base.api.service.ICourseService;
import com.shsunedu.base.api.util.EnumUtil.CourseType;
import com.shsunedu.tool.JsonUtil;

@RestController
@RequestMapping("/courseLesson")
public class CourseLessonApi extends BaseApi {
    @Resource
    ICourseLessonService courseLessonService;
    @Resource
    ICourseService courseService;
    @Resource
    ICourseLessonLearnService courseLessonLearnService;

    /**
     * 方法名: CourseLesson<br>
     * 描述: 课程课时列表(定位上次学习的课程)<br>
     * 时间: 2017年7月4日下午3:14:25
     * @author: star
     * @param courseId
     * @return String
     */
    @RequestMapping("/lesson")
    public String CourseLesson(Integer courseId) {
        JsonUtil jsonUtil = new JsonUtil();
        Course course = courseService.selectByPrimaryKey(courseId);
        try {
            Integer userId = getIdFromToken();
            if (course != null) {
                jsonUtil.addToRoot("type", course.getType());
                if (course.getType().equals(CourseType.LIVE.getValue())) {
                    jsonUtil.addToRoot("course", courseLessonService.listLiveLesson(courseId, userId));
                }
                if (course.getType().equals(CourseType.NORMAL.getValue())) {
                    jsonUtil.addToRoot("course", courseLessonService.listVideoLesson(courseId, userId));
                }
            }
            jsonUtil.addToRoot("nearCourseLesson",
                    courseLessonLearnService.SelectLessonByCourseid(courseId, getIdFromToken()));
            return jsonUtil.toSuccessString();
        } catch (Exception e) {
            e.printStackTrace();
            return jsonUtil.toErrorString(e.getMessage());
        }
    }
}
